module.exports=function(){this.exec=function(a="",b){var c=a.replace("\n","").replace("\r","").replace("<!DOCTYPE html>",""),d=this.parseHtml(this.clean_line(c));b(d)},this.parseHtml=function(a="",b=0){a=this.clean_line(a);let d=[];if(0>b||0>=a.length)return null;for(;"<"!=a[0]&&0<a.length;)a=a.slice(1);for(;1===a.indexOf("<!--");)a=a.slice(a.indexOf("-->"));let e=this.getBaliseInfo(a);if(-1!=e.index){let f=e.index,g=0;if("script"!=e.balise.name){if(!1==e.balise.is_end){g=this.getPosEndOfBalise(a,e),f=g+3+e.balise.name.length;let h=a.slice(e.index+1,g);-1==this.getBaliseInfo(h).index&&(e.balise.value=h),e.balise.next=this.parseHtml(h,b+1),d.push(e.balise);let j=this.parseHtml(a.slice(f),b+1);if(j)for(let k=0;k<j.length;k++)d.push(j[k])}else{f=e.balise.pos_end,d.push(e.balise);let h=this.parseHtml(a.slice(e.balise.pos_end),b+1);if(h)for(let j=0;j<h.length;j++)d.push(h[j])}return d}return null}},this.getPosEndOfBalise=function(a="",b){let c=b.balise.name.length+1,d=a.slice(c),e=0;for(;0<d.length;){let f=d.indexOf("</"+b.balise.name),g=d.indexOf("<"+b.balise.name);if(g<f&&-1!==g)e--,c+=g+1+b.balise.name.length;else{if(e++,1==e)return f+c;c+=3+b.balise.name.length+f}d=a.slice(c)}},this.getBaliseInfo=function(a=""){let b=a.indexOf("<"),c=a.indexOf(" "),d=a.indexOf(">"),e=a.indexOf("/>"),f=!0;(e>d||-1===e)&&(e=d,f=!1),(e<c||-1===c)&&(c=e);let g=a.slice(b+1,c);-1!==["link"].indexOf(g)&&(f=!0);let h=a.slice(b+1+g.length,e).trim(),j=null;if(""!=h){j=h.split(" ");let l=[],m=!1,n="";for(let o=0;o<j.length;o++)-1===j[o].indexOf("\"")&&!1==m?l.push(j[o]):j[o].indexOf("\"")!=j[o].lastIndexOf("\"")&&!1==m?l.push(j[o]):(-1!==j[o].indexOf("\"")&&!1==m&&(m=!0),n+=" "+j[o],j[o].lastIndexOf("\"")&&!0==m&&j[o].lastIndexOf("\"")==j[o].length-1&&(m=!1,l.push(n.trim()),n=""));j=l}let k={name:g,content:j,is_end:f};return!0==k.is_end&&(k.pos_end=e),{index:d,balise:k}},this.clean_line=function(a){if(!a)return a;for(;-1!==a.indexOf("  ");)a=a.replace("  "," ");return a.replace("\t","").replace("\r","").trim()}};